package at.kraschitzer.roco;

import at.kraschitzer.roco.util.HexCaster;
import javafx.application.Application;
import javafx.embed.swing.SwingFXUtils;
import javafx.scene.Scene;
import javafx.scene.image.ImageView;
import javafx.scene.layout.Pane;
import javafx.stage.Stage;

import java.awt.*;
import java.awt.image.BufferedImage;
import java.awt.image.ColorModel;
import java.awt.image.DataBuffer;
import java.awt.image.DataBufferInt;
import java.awt.image.DirectColorModel;
import java.awt.image.PixelGrabber;
import java.awt.image.Raster;
import java.awt.image.WritableRaster;

public class JPEGProblem extends Application {

    public static void main(String[] args) {
        launch(args);
    }

    @Override
    public void start(Stage window) throws Exception {
        BufferedImage bi = getBufferedImage();
        ImageView imgView = getFinalImageView(bi);
        window.setScene(new Scene(new Pane(imgView)));
        window.show();
    }

    private BufferedImage getBufferedImage() throws InterruptedException {
        final java.awt.Image image = Toolkit.getDefaultToolkit().createImage(HexCaster.unstringify("ffd8d8ffe200094156454f323838ffdb0084000d09080d132029310a0a0b0f152e302c0b0a0d13202e372d0b0e1217294640320e121e2d3657523e131c2c3341535a4a27333e46526160513a4a4c4e5a50524f010e0e13264f4f4f4f0e1115354f4f4f4f13152d4f4f4f4f4f26354f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4f4fffc00011080168028003012100021101031101ffc401a20000010501010101010100000000000000000102030405060708090a0b100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9fa0100030101010101010101010000000000000102030405060708090a0b1100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a7374757677787efdab000000797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00f36a5a900a4aa2428a900a280168a00292800a2800a2800a2a80296a40292800a5a0028a00292800a5a004a280168a004a5a004a2800a2800a5a004a5a004a280168a004a2800a5a004a5a004a2801692801692800a2800a5a004a2800a2800a5a004a5a004a5a004a2800a2800a0d002d140051400525002d140051400514005140051400525002d14005140051400514005140094b400945002d140051400945002d14000a2800a2800a4a00296800a2800a2800a4a00296800a4a005a2800a4a0029680128a00296800a2800a4a00296801296800a4a005a4340052d00149400b4500252d00252d00251400b450019a4a00296800a2800a2800a280129680129680128a00296800a2801296800a4a005a4a0028aa00a5a92828a090a2800a4a005a4a0028a005a4a005a4a00296800a4a0028a0028a002968284a5a09128a0028aa00a2a4028a002835401454941450485154014b5202514142d250485140052d0025140051400b4940052d0014500252d0025140052d00252d05094b412252d001494005154014b52025140052d0025140052d0025140052d0014940052d0014940051400b4940052d00251400514005141414504851414141a0029682428a004a5a0028a0029280168a0028a004a5a004a2800a5a0028a0028a0028cd0014940052d0014500252d001466800a4a005a2801296800a2800a4a005a4a005a4aa01692a4a168a090a2800a280128a005a314005140094b40094b40094b4005140094a2800a4a0029680128340052d0025140051400b4500251400b4500149400b4940051400b4940052d00149400b450014940051400b49400b494005140051400b4940052d00149400b4500252d00149400b8a31400518a0028c50018a2800a2800a4a0028a0028a005a4a0029680128a005a2801296800a28012835402d15250514121450014500149400b45001450019a4a005a2801296800a4a00296800a2801296800a2800a2800a2800a2800a2800a2800a282828a090a2800a2800a00a005a2900628c50018a2a8028c50025148028a004a5a0028a0028a0028a0028a0029280168a004a2801690d00145002d25002d140051400525001450014b40094b40094b4005140094b40051400514005140094b4005140051400514005140051400945002d14005140051400014ec5300c52d4884a3140051414141a04368a601450014500145001450014500145001450018a2800a2800a46a0028a0028a00296801296800a2800a4a005a280129682828a090a4a00296801296800a282828a090a2800a28007ffdab000000a2800a2800a2800a2800a2800a2800a282828a091ca29d4862628c532428a40145301290d218945300a2800a2800a2800a2800a2800a2800a2800a2801296800a43400515402d25480b4500145001450014500252d0014500252d001450025140052d001450014500145001450014500145050514121450014500145001463fc6800a00a00900a2908292900515401452284a0d00368a620a2800a2800a2800a2800a2800a2800a2800a2800a2800a43400b4505094b412251400b4500145001450014500252d00251400b450025140051400b4500252d0014500145001466800a2800a2800a2801296800a2800a2800a7a8a60c5a290052548828a180514c0290d031b45300a2800a2800a2800a282828a090a2800a2800a2800a33400521a0a168a090a2800a4a005a2801296800a2800a4a005a4a005a2800a2800a2801296800a2800a2800a2800a33400514005140094b40051400514005140051400aa29f498985148028a004a2800a2980941a0a1b45310514005140051400514005140051400514005140052500141a00296801296800a2801296800a4a00296800a2800a4a0a168a090a2800a2800a2801296800a2800a2800a2800a2801296800cd14005140094b4005140051400f029690828a041453189466a4028a602521a004a298c28a0028a0028a0028a0028a0028a004a5a0028a00292800a0d050b49412145002d25002d140051400945002d2500145002d14005140094b5402515250b450485140051400514005140051400514005250014b4005140053945301734b9a900a281094b4c04a2a40292980521a0a128a620a2800a2800a2800a2800a2801296801296800a4a005a4a00283400b49400b49400b4940051400b450019a4a0029680128a0029680128a005a4a005a4a005a2800a2800a4a005a2800a280128a005a4a005a4a00296800a2800a7669b01334a2810b9a5a80128aa00cd14142514890a4340c4a298051400514005250014b400514005266800a280168a00292801690d0014550052d494251412145001450014b400525002d25002d14005140052500145002d14005140051400514005140094b40094b414252d0485140051400e5148d4804a70aa0168a56105140051400945200a4340c4a29805140051400945001450014b400514005250014500145002d06801296800a2800a2801296800a4a00296800a4a0028a005a280128a005a4a0028a005a2800a2800a280128a005a2800a2800a2800a2800a2800a00a007d34d2012945301d45210514005250014500148680128a631296801296800a2800a2800a4a005a2800a2801296801296800a0f4a06252d020a2801296800a2800a2800a2800a2800a2800a280128a005a2801296800a2800a2800a2801296800a2801296800a4a005a2800a2800a5140080fdab000000b48698c4a5a421452d2105250014500145030a43400945300a4a005a2800a2801296801296800a4a0028aa00a5a9012945002d2374a0425140c28a00296800a4a005a2800a4a005a2800a2800a2800a2800a282828a09129680128aa0168a900a2800a2800a2801296801296801296801714a2980521a9100a5028185140828a0a0a280128a0028cd002514c4252d00149414145048b49400b49400b450014940051400528a005a46a620a290c4a5a00292800a2800a5a004a5a004a5a0029280168a0028a0028a0028a00292800a5a004a5a0028c50018a31400628c50018a31400628c500145002d28a601486a40052d036145020cd19a0619a4cd020a4cd002d14c04a2800a4a005a280128a00296801296800a4a0028a005a2800a51400523500252d00252d0014940052d00145001450014500145001450014500145001450014500145001450014b400514c614b400945020a5a0636969082945200a42281094531851400502801d4948028aa00a280128a40149400b4500252d001450018a2800a2800a4a00296a8028a900a43400b45001494142d141214500252d00145001466800a2800a2800cd14005140051400b4940052d002e47a0fad250317f0a282428a450514c90a2980519a0a128a420a5cd300cd266a40414b4c0292800a2801d46690099a29800a280128a0028a0028a003345001466800a2800c518a00314500252d0015325b6e1c4b08f627fa56d4e17d9a149f9318f130eb8c7623bd4668a90b6ed045f6168ac4614940052d00252d050525048b45001450014500149400b4500145001450019a4a005a2800a5068017346690828a0a0a334009ba96800a2810da298052d0019a2801297340051400525002e68cd03128a0414b40094500149400b4505094b412252d0014500028cd0014940052e2800a2802459cff00100477e299263f87ebf4addcb4d7e44a5d86d2d606814941214500145050b494121455142d254922d1400525002d25002d25002d2500145002d140051414145048519a0033450014b9a0033466980945200a2800a2800a28017349400668a0028a0033466800a33400668cd0019a33400668a0028cd001466800cd19a00293340051400528340051400523500145001450014b4142803b9a7cc918ff00552eff005e318fcea5dfa23449757e845455188b4500149400b4500149400b4500149400b4940052d00251400b450014500145001450014500145002d140094b40052500145001450014505094b41218a2800a2800a2800a280128a0a168a0028a0028a090a4a0028a005a2801296800a46a005a2800a4a005a4a005a282828a090a4a00296801296800a2800a2800a2800a4a005cd1400525002d140051400514005140051400b8a4c5002d14c028a00314520128a0028a0028a0028a0028a00281fdab0000008a0028a0028a0028a0029280168a00292800a280168a0029280168a004a0d00145002d250014b400525002d140094b400945002d141414504851400514005140094b400514005140051400514005140051400b45201692800a2800a280128a601450014500145001466800a2800cd250014b40094b40051400514005250014b400514005140094500141a0029680128a00296800a4a00296800a280128a005a2800a2801296800a2800a2800a31400514005140094b40094b5402515250b45048b45201692800a2a802835202514c028a0028a0028a0028a0028a00314500145001450014500252d00251400b4940052d002d250014500250680168a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a005a2800a5a402502a800d15230a29884a2800a2800a2800a2800a5a004a2800c518a0028a0028a0028a0028a0028a0028a005a4340c292810b8a43400b4500252d00252d00252d001450014500251400b9a2800a2800a2800a2800a2800a2800a2801296800a2800a2800a2800a4a005a280168a401455005252016929805148029280168a0028a0028a0028a0028a0028a00292800a280168a0028a00292801d4940094500141a005a2800a4a005a282828a090a2800a280128a0a16928245c51400514005140051400514005140094b40051400514005140094b40051400b466900515401494805a2900525300a2800a4a005a2800a2800a2800a2800a2800a4a00296801296800a2800a2800a280128a00283400b49400b494005141414b412145001450025141414b412252d0014500145001450014500251400b45001450014500252d00149400b450014b4005148028a60145300a4a0028a40252d00252d00252d00145001450014500145002514005154014b5201450014500149400506800a5a0028a0028a0028a0028a0028a0028a0028aa2828a92428a0028a004a5a00292800a5a0028a0028a004a2800a5a004a2800a5a0028a003345002d19a0028a0028a402514c028a0028a0028a0028a0028a0028a0028a0028a0028a0028a0028a004a5a004cd140050680168a00292800a5a0a128a09168a0028a0029280168a00292800a5a0029280168a0028a004a5a0028a0028a004a5a0028a004a280168a004a5a0028a0028a0028a005a4a6014500145200a2800a2800a2800a280128a005a4a005a2801296800a2800a2801296801296801283400b4500251400b45001450014500252d0014500149400b450025140051400b4500252d00145001450014500145001450014940052d00251400b45001462800a2800a3340051400514005140051414252d04852500145002d1400945002d140051400514009450014500141a0a168a090a4a00334b4009450019a5a002982fdab0000002801692800a2800a5aa0128a900a2a805cd19a901296801334500145002d140094b40094500145500b495202d2500145002d14009450014500145500b45480514009450014b9a00334940052d05094b412252d0019a2800a280128a0028aa285a4a090a0d48052d00145001450018a2800a2800a2800a4a00296800a4a0029680128a005a2800a280129680129682828a09129680128a005a4a005a2800a2800a2800a2800a2801296800a4a005a4a005a2800a2800a4a005a4a00296800a2800a4a005a2800a2800a4a0028a002968012834141450485140052d0025140051540145480514142d141214940051545051524851545051524852d00251400b9a280128a0028aa2828a92429680128a0028a005a4a0029680128a005a4a0029680129680129680128a0029680128a00296800a4a00296800a280128a0028a0028a002835402d25480b494141450485140052d00149400b49400b450014500252d00149400514142d14122514005141414b412252d0025140052d00251400514005140052d00252d00252d0014500149400b45001450014500149400514005140052d050945048b498a002968284a5a09128c500141a0a0a282428a0029680129680128a0028a0029680128a0a169282429680128a0028a0028a00296800a280128a00296800a4cd0014b4005250014500145002d25002d1400514005140094b400525002d25002d25500b4952014b4005140094b4005250014500145001450014500141a005a280128a0029680128a005a4a005a4a005a4a0028a0a0a5a09128a00296800a4a0029680128a005a2800a4a002968001494005140052e280128a0028a0029680128a00296800a2800a2800a2801296800a2800a4a005a4a0029680128a00296800a280128a0028a0028aa00a0d050b495248b4940052d00252d001450014500251400b4940052d0014940051400b450025140052d00251400b450014500251414145048b45002514005140052d0014940052d00149400b450014500251400b450014940051400b4940051400b45001495401454805140052d002506800a2800a2801692800a2800a5a004a2801692801692800a5a0a0a4a090a2801692800a2a805a2a404a2a805a2a404a2a8028a005a4a900a2800a2800a2a8028a901692800a5a002928282968244a5a004a5a00292800a2800a5a00292800a2801692801692800a5a004a2800a2800a0d002d14005140094b400525001450014b4005140094b40051400514005140052500145500b4952014b40051400514005250014b40094505052d04894b4005250014b40094b4009450014b40094b40051400525002d250014b40094b400945002d14005250014b40094b40094b4005235050b4941214b414149412145002d250014500145002d25002d1400945500515283fdab00000002d25001450014500145500b45480945001450014500145002d2500145002d2500145002d250014b4005140094b400945002d14009450014500145002d140051400525002d14005250014500141a00ffd9"));

        final int[] RGB_MASKS = {0xFF0000, 0xFF00, 0xFF};
        final ColorModel RGB_OPAQUE =
                new DirectColorModel(32, RGB_MASKS[0], RGB_MASKS[1], RGB_MASKS[2]);

        PixelGrabber pg = new PixelGrabber(image, 0, 0, -1, -1, true);
        pg.grabPixels();
        int width = pg.getWidth(), height = pg.getHeight();
        DataBuffer buffer = new DataBufferInt((int[]) pg.getPixels(), pg.getWidth() * pg.getHeight());
        WritableRaster raster = Raster.createPackedRaster(buffer, width, height, width, RGB_MASKS, null);
        return new BufferedImage(RGB_OPAQUE, raster, false, null);
    }

    private ImageView getFinalImageView(BufferedImage bi) throws Exception {
        ImageView imgView = new ImageView(SwingFXUtils.toFXImage(bi, null));
        imgView.setFitWidth(1024);
        imgView.setFitHeight(756);
        imgView.setRotate(180);
        return imgView;
    }
}